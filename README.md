
# TACO Segmentation Pipeline

This repository describes the end-to-end process used to prepare, augment, and train a YOLOv11 segmentation model on the TACO (Trash Annotations in Context) dataset and its extensions.

## Overview

The project is executed in three main stages:

1. Data Merging & Preprocessing (`taco_merge.ipynb`)  
2. Data Augmentation & Stratified Splitting (`taco_augmentation.ipynb`)  
3. YOLOv11 Segmentation Model Training (`taco_train.ipynb`)

## 1. Data Merging (`taco_merge.ipynb`)

### Objectives

- Combine the original TACO dataset and TACO extra dataset containing rare classes.
- Map all classes to a consolidated 25-class schema.
- Eliminate noisy or unused labels (e.g., batteries, blister packs).
- Normalize annotations for YOLOv11-compatible polygon segmentation.

### Steps

1. Download datasets using the Roboflow API.
2. Map classes from both datasets using `class_to_group` and `consolidated_lookup` dictionaries.
3. Filter out labels mapped to `-1` (ignored classes).
4. Remap and rewrite label files to match the new class index.
5. Merge image and label files into a single unified dataset directory (`/merged`).
6. Perform visual validation of random samples to verify label remapping.

## 2. Data Augmentation & Split (`taco_augmentation.ipynb`)

### Objectives

- Address class imbalance by applying targeted augmentations.
- Create a balanced dataset using pixel-level transformations.
- Perform a stratified split to maintain class representation across train, val, and test.

### Augmentation Details

Only classes with fewer than 100 instances were augmented.  
Augmentations used per rare image: 5

#### Albumentations Pipeline

The following pixel-level (non-spatial) augmentations were applied:

- ColorJitter (brightness, contrast, saturation, hue)
- GaussNoise
- MotionBlur
- CLAHE
- ImageCompression
- Downscale (low-res simulation)

These augmentations do not affect image geometry, preserving label integrity.

### Dataset Splitting

- Uses Multilabel Stratified Shuffle Split (from `iterative-stratification`) to preserve label distributions.
- Splits:
  - Train: 80%
  - Validation: 10%
  - Test: 10%

### Output

Dataset in YOLO format:

```
TACO_dataset/
├── train/
├── valid/
└── test/
```

A `data.yaml` file is generated with the appropriate class list and paths.

## 3. YOLOv11 Training (`taco_train.ipynb`)

### Model

- YOLOv11 segmentation model (Ultralytics)
- Pretrained weights used: `/kaggle/input/yolo_taco/pytorch/v11/1/last.pt`

### Training Configuration

| Parameter         | Value      |
|------------------|------------|
| epochs           | 500        |
| batch            | -1 (auto)  |
| imgsz            | 640        |
| optimizer        | AdamW      |
| lr0              | 0.001      |
| lrf              | 0.01       |
| dropout          | 0.2        |
| freeze           | 10 layers  |
| device           | 0 (GPU)    |
| seed             | 42         |
| amp              | True       |
| deterministic    | True       |
| patience         | 50         |

### Spatial Augmentations During Training

| Augmentation  | Value |
|---------------|--------|
| degrees       | 20.0   |
| translate     | 0.1    |
| scale         | 0.8    |
| shear         | 10.0   |
| perspective   | 0.0005 |
| flipud        | 0.0    |
| fliplr        | 0.5    |
| mosaic        | 1.0    |
| mixup         | 0.2    |
| cutmix        | 0.2    |
| copy_paste    | 0.3    |

These augmentations are applied on-the-fly during training to increase model robustness.

## Final Class List (25 Classes)

```
['Cigarette', 'Plastic bottle', 'Plastic wrapper', 'Plastic container', 'Plastic cup',
 'Plastic lid/cap', 'Plastic utensil', 'Plastic straw', 'Plastic bag', 'Plastic gloves',
 'Foam container', 'Paper straw', 'Paper', 'Paper container', 'Carton', 'Metal can/lid',
 'Scrap metal', 'Glass', 'Aluminium/foil', 'Rope/string', 'Aerosol', 'Tissues',
 'Unlabeled litter', 'Food waste', 'Other']
```

## Output

- Trained YOLOv11 model saved in: `runs/segment/v2/`
- Logs, plots, and validation metrics are generated by the Ultralytics trainer.
- The model is ready for inference on segmentation tasks with polygon annotations.

## Evaluation results

- Normalized confusion matrix
  ![confusion_matrix_normalized](https://github.com/user-attachments/assets/8d10874e-a8c4-4a16-9a31-1b2a9da683bf)

- Metrics
  ![results](https://github.com/user-attachments/assets/6ba865fb-2005-46b0-96cb-29bf5b8a922a)


## Notes

- The pipeline uses polygon segmentation (not bounding boxes).
- Data augmentation and training occur only after dataset merging and remapping.
- All steps are reproducible due to fixed seeds and deterministic settings.
